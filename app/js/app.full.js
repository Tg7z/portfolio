var appVersion="0.1",firebaseURL="https://tg-folio.firebaseIO.com";
angular.module("portfolioApp",["portfolio.filters","portfolio.services","portfolio.directives","portfolio.controllers","ngRoute","firebase","ui.bootstrap","ngSanitize"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"partials/blog.html",controller:"BlogCtrl"}).when("/posts/:id",{templateUrl:"partials/blog-item.html",controller:"PostCtrl"}).when("/posts/:id/edit",{templateUrl:"partials/add.html",controller:"AddEditCtrl",authRequired:true}).when("/tags/:tag",
{templateUrl:"partials/blog-tag.html",controller:"TagCtrl"}).when("/search",{templateUrl:"partials/search.html",controller:"SearchCtrl"}).when("/cv",{templateUrl:"partials/cv.html",controller:"CvCtrl"}).when("/bio",{templateUrl:"partials/bio.html",controller:"BioCtrl"}).when("/login",{templateUrl:"partials/login.html",controller:"LoginCtrl"}).when("/add",{templateUrl:"partials/add.html",controller:"AddEditCtrl",authRequired:true}).otherwise({redirectTo:"/"})}]).constant("version",appVersion).constant("FBURL",
firebaseURL).run(["$rootScope","$firebaseAuth","FBURL",function($rootScope,$firebaseAuth,FBURL){var ref=new Firebase(FBURL);$rootScope.auth=$firebaseAuth(ref,{path:"/login"});$rootScope.FBURL=FBURL}]);angular.module("cvApp",["portfolio.filters","portfolio.services","portfolio.directives","portfolio.controllers","ngRoute","firebase"]).constant("version",appVersion).constant("FBURL",firebaseURL).run(["$rootScope","FBURL",function($rootScope,FBURL){$rootScope.FBURL=FBURL}]);angular.module("portfolio.controllers",[]).controller("CoreCtrl",["$rootScope","$scope","$firebase","loginService","FBURL",function($rootScope,$scope,$firebase,loginService,FBURL){$scope.pagetitle={};$scope.pagetitle.pagename="Didacticode";$scope.mobilemenu=false;var refBio=(new Firebase(FBURL)).child("/bio");$scope.bio=$firebase(refBio);$scope.logout=function(){loginService.logout("/login")};$scope.openMenu=function(){$scope.mobilemenu=true};$scope.closeMenu=function(){$scope.mobilemenu=false};$scope.$on("$routeChangeSuccess",
function(ev,current,prev){if($scope.mobilemenu)$scope.closeMenu()})}]).controller("BlogCtrl",["$scope","$firebase","FBURL",function($scope,$firebase,FBURL){$scope.pagetitle.pagename="All Posts - Didacticode";var refPosts=(new Firebase(FBURL)).child("/posts");$scope.posts=$firebase(refPosts);$scope.posts.$on("change",function(){if($scope.posts)angular.element(document.querySelector(".post-loader")).remove()})}]).controller("PostCtrl",["$scope","$sce","$routeParams","$firebase","FBURL",function($scope,
$sce,$routeParams,$firebase,FBURL){$scope.postId=$routeParams.id;var refPost=(new Firebase(FBURL)).child("/posts/"+$scope.postId);$scope.data=$firebase(refPost);$scope.data.$on("change",function(){var title=$scope.data.title;if(title)$scope.pagetitle.pagename=title+" - Didacticode";if($scope.data)angular.element(document.querySelector(".post-loader")).remove()});$scope.htmlUnsafe=function(){if($scope.data.content)return $sce.trustAsHtml($scope.data.content)}}]).controller("TagCtrl",["$scope","$routeParams",
"$firebase","FBURL",function($scope,$routeParams,$firebase,FBURL){$scope.tag=$routeParams.tag;$scope.pagetitle.pagename="Posts tagged "+$scope.tag+" - Didacticode";var refPosts=(new Firebase(FBURL)).child("/posts");$scope.posts=$firebase(refPosts);$scope.posts.$on("change",function(){if($scope.posts)angular.element(document.querySelector(".post-loader")).remove()})}]).controller("SearchCtrl",["$scope","$location","$firebase","FBURL",function($scope,$location,$firebase,FBURL){$scope.q=$location.search();
$scope.pagetitle.pagename="Search results - Didacticode";var refPosts=(new Firebase(FBURL)).child("/posts");$scope.posts=$firebase(refPosts);$scope.posts.$on("change",function(){if($scope.posts)angular.element(document.querySelector(".post-loader")).remove()})}]).controller("RecentPostsCtrl",["$scope","$firebase","FBURL",function($scope,$firebase,FBURL){var refPosts=(new Firebase(FBURL)).child("/posts").limit(10);$scope.recentPosts=$firebase(refPosts);$scope.recentPosts.$on("change",function(){if($scope.recentPosts)angular.element(document.querySelector(".recent-loader")).remove()})}]).controller("TileGridCtrl",
["$scope","$window",function($scope,$window){$scope.rowHeight=0;$scope.gridfillOptions={cols:3,tile_ratio:"4:3",selector:"blog-posts",tileSelector:"blog-post"};$scope.$parent.$on("ngRepeatFinished",function(){gridfill.initialize($scope.gridfillOptions)});$window.onresize=function(){var width=window.innerWidth||(document.documentElement.clientWidth||document.body.clientWidth);if(width>=960)gridfill.layoutGrid()}}]).controller("TagCloudCtrl",["$scope","$firebase","FBURL",function($scope,$firebase,FBURL){var refTags=
(new Firebase(FBURL)).child("/tags");$scope.tagData=$firebase(refTags);$scope.tagData.$on("change",function(){if($scope.tagData)angular.element(document.querySelector(".tagcloud-loader")).remove()})}]).controller("HeaderCtrl",["$scope","$location",function($scope,$location){$scope.query=$location.search().q;$scope.keywordSearch=function(){if(this.query)$location.path("/search").search("q",this.query)}}]).controller("CvCtrl",["$scope",function($scope){$scope.pagetitle.pagename="Curriculum Vitae of Tim Geurts - Didacticode"}]).controller("BioCtrl",
["$scope",function($scope){$scope.pagetitle.pagename="More about the author: Tim Geurts - Didacticode"}]).controller("LoginCtrl",["$scope","loginService",function($scope,loginService){$scope.pagetitle.pagename="Login - Didacticode";$scope.email=null;$scope.pass=null;$scope.remember=true;$scope.login=function(callback){$scope.err=null;var redirectTo="/add";loginService.login(this.email,this.pass,this.remember,redirectTo,function(err,user){$scope.err=err||null;typeof callback==="function"&&callback(err,
user)})}}]).controller("AddEditCtrl",["$scope","$q","$routeParams","$location","$firebase","FBURL",function($scope,$q,$routeParams,$location,$firebase,FBURL){var init=function init(){var refTags=(new Firebase(FBURL)).child("/tags");$scope.editId=$routeParams.id;if($scope.editId){$scope.pageHeading="Edit post: ";var refPost=(new Firebase(FBURL)).child("/posts/"+$scope.editId);$scope.master=$firebase(refPost);$scope.master.$on("change",function(){$scope.pageHeading="Edit post: "+$scope.master.title;
$scope.pagetitle.pagename="Edit "+$scope.master.title+" - Didacticode";angular.forEach($scope.master,function(value,key){if(typeof value==="function")delete $scope.master[key]});if(!$scope.master.tags)$scope.master.tags=[];$scope.resetForm()})}else{$scope.pageHeading="Add Post";$scope.pagetitle.pagename="Add Post - Didacticode";$scope.master={author:"Tim Geurts",tags:[]}}$scope.tagList=["Portfolio","JavaScript","AngularJS","AngularFire","Firebase","HTML","CSS","App","WebApp"];$scope.tagData=$firebase(refTags);
$scope.newTag=null};init();$scope.dateOptions={"year-format":"'yy'","starting-day":1};$scope.openDate=function($event){$event.preventDefault();$event.stopPropagation();$scope.opened=true};$scope.tagData.$on("loaded",function(value){var tags=[];angular.forEach(value,function(v,k){tags.push(k)});$scope.tagList=tags});$scope.addTag=function(){$scope.post.tags.push($scope.newTag);var position=$scope.tagList.indexOf($scope.newTag);if(~position)$scope.tagList.splice(position,1);$scope.newTag=null};$scope.removeTag=
function(tag){var position=$scope.post.tags.indexOf(tag);if(~position)$scope.post.tags.splice(position,1);$scope.tagList.push(tag);$scope.newTag=null};$scope.updateRelease=function(){var release_time=$scope.release_time;var release=$scope.release_date;if(release){release.setHours(release_time.getHours());release.setMinutes(release_time.getMinutes());release.setSeconds("00")}else release=new Date;$scope.post.release=release.getTime()};$scope.resetRelease=function(){var now=new Date;$scope.release_date=
now;$scope.release_time=now;$scope.master.release=now.getTime()};$scope.resetForm=function(){if($scope.editId){var release;if($scope.master.release)release=new Date($scope.master.release);else release=new Date;$scope.release_time=release;$scope.release_date=release;var masterTags=$scope.master.tags;angular.forEach(masterTags,function(value,i){var position=$scope.tagList.indexOf(value);if(~position)$scope.tagList.splice(position,1)})}else $scope.resetRelease();$scope.post=angular.copy($scope.master)};
$scope.savePost=function(){var refPosts;var postName="";if($scope.editId)refPosts=(new Firebase(FBURL)).child("/posts/"+$scope.editId);else{var postDate=new Date($scope.post.release);var yyyy=postDate.getFullYear().toString();var mm=(postDate.getMonth()+1).toString();var dd=postDate.getDate().toString();postName+=yyyy+"-"+(mm[1]?mm:"0"+mm[0])+"-"+(dd[1]?dd:"0"+dd[0])+"-";postName+=encodeURIComponent($scope.post.title.split(" ").join("-").split(".").join("-").toLowerCase());refPosts=(new Firebase(FBURL)).child("/posts/"+
postName)}var incrementTags=null;var decrementTags=null;if($scope.editId){var tags=$scope.post.tags.slice(0);var masterTags=$scope.master.tags.slice(0);angular.forEach(masterTags,function(value,i){var match=tags.indexOf(value);if(~match){delete tags[match];delete masterTags[i]}incrementTags=tags;decrementTags=masterTags})}else incrementTags=$scope.post.tags;var allPromises=[];var updateTags=function(value,index,increment){var dfd=$q.defer();var refTag=(new Firebase(FBURL)).child("/tags/"+value);refTag.transaction(function(current_value){if(increment)return current_value+
1;else return current_value-1},function(error,committed,snapshot){if(committed)dfd.resolve(snapshot);else dfd.reject(error)});allPromises.push(dfd.promise)};if(incrementTags)angular.forEach(incrementTags,function(value,index){updateTags(value,index,true)});if(decrementTags)angular.forEach(decrementTags,function(value,index){updateTags(value,index,false)});var dfd=$q.defer();refPosts.set($scope.post,function(error){if(error)dfd.reject(error);else dfd.resolve("post recorded")});allPromises.push(dfd.promise);
$q.all(allPromises).then(function(){var postId;if($scope.editId)postId=$scope.editId;else postId=postName;$location.path("/posts/"+postId)},function(error){console.log(error);alert("Error: something went wrong your post has not been created.")})};$scope.resetForm()}]);angular.module("portfolio.directives",[]).directive("a",function(){return{restrict:"E",link:function(scope,elem,attrs){if(attrs.ngClick||(attrs.href===""||attrs.href==="#"))elem.on("click",function(e){e.preventDefault();if(attrs.ngClick);})}}}).directive("onFinishRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){if(scope.$last===true)$timeout(function(){scope.$emit("ngRepeatFinished")})}}}).directive("tileGrid",function(){return{restrict:"EA",controller:"TileGridCtrl",
scope:true}}).directive("blogHeader",function(){return{restrict:"EA",templateUrl:"partials/header.html",controller:"HeaderCtrl",scope:true,replace:true}}).directive("blogSidebar",function(){return{restrict:"EA",templateUrl:"partials/sidebar.html",replace:true}}).directive("blogTags",function(){return{restrict:"EA",templateUrl:"partials/tag-cloud.html",controller:"TagCloudCtrl",replace:true,scope:true}}).directive("postTags",function(){return{restrict:"EA",templateUrl:"partials/tag-cloud-post.html",
controller:"TagCloudCtrl",replace:true,scope:true}}).directive("recentPosts",function(){return{restrict:"EA",templateUrl:"partials/recent-posts.html",controller:"RecentPostsCtrl",replace:true,scope:true}}).directive("portfolioCv",function(){return{restrict:"EA",templateUrl:"partials/cv.html"}});angular.module("portfolio.filters",[]).filter("releaseDate",function(){return function(posts){var now=(new Date).getTime();var released=[];angular.forEach(posts,function(value,key){if(typeof value==="function");else if(now>parseInt(value.release,10)){value.id=key;released.push(value)}});released.sort(function(a,b){a=parseInt(a.release);b=parseInt(b.release);return b-a});return released}}).filter("excludePost",function(){return function(posts,exclude){if(exclude)angular.forEach(posts,function(value,
key){if(typeof exclude==="string"){if(key===exclude)delete posts[exclude]}else{var excludeKey=exclude.indexOf(key);if(~excludeKey){var deleteKey=exclude[excludeKey];delete posts[deleteKey]}}});return posts}}).filter("tileSize",function(){return function(posts){angular.forEach(posts,function(value,i){if(i===0||value.featured)posts[i].size=2;else posts[i].size=1});return posts}}).filter("searchTag",function(){return function(posts,tag){var results={};angular.forEach(posts,function(value,key){if(typeof value!==
"function"){var tags=value.tags.map(function(elem){return elem.toLowerCase()});if(tags.indexOf(tag.toLowerCase())>=0)results[key]=value}});return results}}).filter("postTag",function(){return function(tags,match){if(match){var results={};angular.forEach(tags,function(value,key){if(match.indexOf(key)>=0)results[key]=value});return results}else return tags}}).filter("searchQuery",function(){return function(posts,query){var results={};angular.forEach(posts,function(value,key){if(typeof value==="function")results[key]=
value;else{var checkTag=function(q){if(value.tags){var tags=value.tags.map(function(elem){return elem.toLowerCase()});if(tags.indexOf(q)>=0)results[key]=value}};var checkVia=function(q){if(value.via){if(value.via.label){var viaLabel=value.via.label.toLowerCase();if(viaLabel.indexOf(q)>=0)results[key]=value}if(value.via.link){var viaLink=value.via.link.toLowerCase();if(viaLink.indexOf(q)>=0)results[key]=value}}};if(query.q){var queries=query.q.split(" ").map(function(elem){return elem.toLowerCase()});
var titleWords=value.title.split(" ").map(function(elem){return elem.toLowerCase()});var contentWords=value.content.split(" ").map(function(elem){return elem.toLowerCase()});if(!query.t)angular.forEach(queries,function(q,i){checkTag(q)});if(!query.v)angular.forEach(queries,function(q,i){checkVia(q)});angular.forEach(titleWords,function(word,i){angular.forEach(queries,function(q,i){if(word.indexOf(q)>=0)results[key]=value})});angular.forEach(titleWords,function(word,i){angular.forEach(queries,function(q,
i){if(word.indexOf(q)>=0)results[key]=value})})}if(query.t)checkTag(query.t.toLowerCase());if(query.v)checkVia(query.v.toLowerCase())}});return results}}).filter("reverse",function(){return function(items){return items.slice().reverse()}}).filter("nospace",function(){return function(input){if(input)return input.replace(/\s/g,"")}}).filter("titlecase",function(){return function(input){var smallWords=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return input.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,
function(match,index,title){if(index>0&&(index+match.length!==title.length&&(match.search(smallWords)>-1&&(title.charAt(index-2)!==":"&&((title.charAt(index+match.length)!=="-"||title.charAt(index-1)==="-")&&title.charAt(index-1).search(/[^\s-]/)<0)))))return match.toLowerCase();if(match.substr(1).search(/[A-Z]|\../)>-1)return match;return match.charAt(0).toUpperCase()+match.substr(1)})}});(function(){angular.module("portfolio.services",[]).factory("isEmpty",function(){return function(obj){if(obj===null||obj===undefined)return true;if(obj.length&&obj.length>0)return false;if(obj.length===0)return true;for(var key in obj)if(hasOwnProperty.call(obj,key))return false;return true}}).factory("loginService",["$rootScope","$location","FBURL",function($rootScope,$location,FBURL){return{login:function(email,pass,remember,redirect,callback){$rootScope.auth.$login("password",{email:email,password:pass,
rememberMe:remember}).then(function(user){if(redirect)$location.path(redirect);callback&&callback(null,user)},callback)},logout:function(redirectPath){$rootScope.auth.$logout();if(redirectPath)$location.path(redirectPath)}}}]);function errMsg(err){return err?"["+err.code+"] "+err.toString():null}})();